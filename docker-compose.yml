# =========================================================
# Sora Automation — Docker Compose
# =========================================================
#
# Two ports:
#   4100 -> Chrome Web UI (KasmVNC) — view & login via browser
#   8000 -> FastAPI REST API — generate/download videos
#
# Usage:
#   cp .env.example .env   # set password
#   docker-compose up -d   # start!
# =========================================================

services:
  sora:
    build: .
    container_name: sora-automation
    security_opt:
      - seccomp:unconfined
    ports:
      - "4100:3000" # Chrome Web UI (KasmVNC)
      - "4101:3001" # HTTPS VNC (optional)
      - "8000:8000" # FastAPI API
    volumes:
      - ./data:/config # Chrome profile data (persistent)
      - ./videos:/app/videos # Generated videos
    environment:
      # Chrome UI login credentials
      - CUSTOM_USER=${CHROME_USER:-admin}
      - PASSWORD=${CHROME_PASSWORD:-changeme}
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
      # Enable CDP for Playwright (connects to same Chrome)
      - CHROME_CLI=--remote-debugging-port=9222 --remote-debugging-address=0.0.0.0 --no-sandbox
      - TITLE=Sora-Automation
      # API Security (optional — leave empty for no auth)
      - API_KEY=${API_KEY:-}
    shm_size: "1gb"
    restart: unless-stopped
